// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import {IStargate} from "@stargatefinance/stg-evm-v2/src/interfaces/IStargate.sol";

import {MessagingFee, SendParam} from "@layerzerolabs/lz-evm-oapp-v2/contracts/oft/interfaces/IOFT.sol";

import {Script, console} from "forge-std/Script.sol";
import {IERC20} from "@openzeppelin/contracts/token/ERC20/IERC20.sol";

import {Remote} from "../src/Remote.sol";
import {StargateComposer} from "../src/StargateComposer.sol";
import {ARB_ENDPOINT, FLOW_STARGATE_OFT_ETH, BASE_STARGATE_POOL_NATIVE, FLOW_CHAIN_EID, BASE_CHAIN_EID} from "./Constants.sol";

// sent eth from ethereum sepolia to arbitrum sepolia
contract TransferEth is Script {
    StargateComposer public stargateComposer;



    function setUp() public {}

    function run() public {
        vm.startBroadcast();

 
        // ! fill with the deployed addresses
        stargateComposer = StargateComposer(
            0x09990daBB3C9Aa22E61B2Ff4436862dC94553645 // address on ethereum sepolia - UPDATE THIS WITH YOUR DEPLOYED ADDRESS
        );

   
     
     
        bytes memory bytesToSend = (hex'a2e42c6500000000000000000000000000000000000000000000000000000000000000400000000000000000000000008604700ae3c4ea791eb1019238ff07a46e41c77a0000000000000000000000004e65fe4dba92790696d040ac24aa414708f5c0ab00000000000000000000000000000000000000000000000000000000000aae6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f45b4fe3595500000000000000000000000009990dabb3c9aa22e61b2ff4436862dc9455364500000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000002c000000000000000000000000000000000000000000000000000000000000003c000000000000000000000000000000000000000000000000000000000000008c00000000000000000000000004e65fe4dba92790696d040ac24aa414708f5c0ab000000000000000000000000a238dd80c259a72e81d7e4664a9801593f98d1c500000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006469328dec000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda029130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ea49d02c248b357b99670d9e9741f54f72df9cb300000000000000000000000000000000000000000000000000000000000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda029130000000000000000000000000000000000000000000000000000000000000080ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000044a9059cbb0000000000000000000000008604700ae3c4ea791eb1019238ff07a46e41c77a000000000000000000000000000000000000000000000000000000000000083400000000000000000000000000000000000000000000000000000000000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000044095ea7b30000000000000000000000006a000f20005980200259b80c5102003040001068000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda029130000000000000000000000006a000f20005980200259b80c5102003040001068000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000444e3ead59e000000000000000000000000000010036c0190e009a000d0fc3541100a07380a000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee00000000000000000000000000000000000000000000000000000000000aae5e0000000000000000000000000000000000000000000000000000f6902531ac330000000000000000000000000000000000000000000000000000fce29c4d33e605057f5df64b4f1698d9465f1f6cc6ec00000000000000000000000001d8499700000000000000000000000000000000000000000000000000000000000000008604700ae3c4ea791eb1019238ff07a46e41c77a98000000000000000000000000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000002a0833589fcd6edb6e08f4c7c32d4f71b54bda029130000006000240000ff00000300000000000000000000000000000000000000000000000000000000a9059cbb000000000000000000000000df033790907c60c9b81ae355f76f74f52f92114a00000000000000000000000000000000000000000000000000000000000aae5edf033790907c60c9b81ae355f76f74f52f92114a00000120002400e42000000b000000000000000000000000000000000000000000000000000000003eece7db000000000000000000000000000010036c0190e009a000d0fc3541100a07380a00000000000000000000000000000000000000000000000000000000000aae5e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7e00000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000420000000000000000000000000000000000000642000000000000000000000000000000000000060000004000040000ff000007000000000000000000000000000000000000000000000000000000002e1a7d4d0000000000000000000000000000000000000000000000000000fce29c4d33e66a000f20005980200259b80c51020030400010680000002000000000ff040009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009990dabb3c9aa22e61b2ff4436862dc945536450000000000000000000000000000000000000000000000000000000000000080ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000');


       
        //bytes memory _composeMsg = abi.encode(address(1), address(FLOW_STARGATE_OFT_ETH), uint32(30184), bool(true), uint(0), bytesToSend);
   
         bytes memory _composeMsg = abi.encode(
            address(0x4e65fE4DbA92790696d040ac24Aa414708F5c0AB),
            address(0xdc181Bd607330aeeBEF6ea62e03e5e1Fb4B6F7C7),
            uint32(FLOW_CHAIN_EID),
            bool(false),
            uint(489080223123123132312840923984),
            bytesToSend
        ); 
        
        (
            uint256 valueToSend,
            SendParam memory sendParam,
            MessagingFee memory messagingFee
        ) = stargateComposer.prepare(
                FLOW_STARGATE_OFT_ETH, // stargate on ethereum sepolia
                BASE_CHAIN_EID, // destinationEndpointId (arbitrum sepolia)
                10000000000000, // amount
                address(0x555F64d059F761a6909F03125cFF87D2cb690595), // to
                _composeMsg, // composeMsg
                1_200_000 // composeFunctionGasLimit
            );

        console.log("Value to send:", valueToSend);
        console.log("Messaging fee:", messagingFee.nativeFee);
        console.log("Total required:", valueToSend + messagingFee.nativeFee);

        
        //IERC20(0x2F6F07CDcf3588944Bf4C42aC74ff24bF56e7590).approve(FLOW_STARGATE_OFT_ETH, 30000000000000);

        // Send the transaction with the correct value
        IStargate(FLOW_STARGATE_OFT_ETH).sendToken{value: valueToSend}(
            sendParam,
            messagingFee,
            0x69EF5048F40b66727aBC0F8B5EAf1eC2C31fDaEc
        );

        vm.stopBroadcast();
    }
}
